<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Potensi Ekraf, Wisata & Hotel Sidoarjo</title>

    <meta http-equiv="Content-Security-Policy" content="
        default-src * data: blob: 'unsafe-inline' 'unsafe-eval';
        script-src * data: blob: 'unsafe-inline' 'unsafe-eval';
        connect-src * data: blob: 'unsafe-inline';
        img-src * data: blob: 'unsafe-inline';
        frame-src *;
        style-src * data: blob: 'unsafe-inline';
        font-src * data: blob: 'unsafe-inline';
    ">

    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.css" type="text/css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@400;600;800&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- VISUAL STYLING --- */
        :root {
            --primary: #2563eb;    
            --accent: #f59e0b;     
            --danger: #ef4444;     
            --success: #10b981;    
            --purple: #8b5cf6;     /* Warna Baru untuk Hotel */
            --glass: rgba(255, 255, 255, 0.95);
            --glass-blur: blur(16px);
            --shadow: 0 10px 40px -10px rgba(0,0,0,0.2);
        }

        body { margin: 0; padding: 0; font-family: 'Mulish', 'Poppins', sans-serif; overflow: hidden; }
        
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }

        /* HEADER */
        .page-header {
            position: absolute; top: 20px; left: 20px; right: auto;
            background: var(--glass);
            padding: 15px 25px; border-radius: 16px;
            box-shadow: var(--shadow);
            backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
            z-index: 10; display: flex; align-items: center; gap: 15px;
            max-width: 380px; border: 1px solid rgba(255,255,255,0.6);
        }
        .header-logo {
            width: 45px; height: 45px;
            background: linear-gradient(135deg, var(--primary), #4f46e5);
            border-radius: 12px; display: grid; place-items: center;
            color: white; font-size: 20px; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .header-text h1 { margin: 0; font-size: 18px; font-weight: 800; color: #1e293b; letter-spacing: -0.5px; }
        .header-text p { margin: 0; font-size: 12px; color: #64748b; font-weight: 600; }

        /* TOGGLE STYLE */
        .controls-group {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 10px; z-index: 10;
        }
        .control-btn {
            background: var(--glass); border: none; padding: 10px 20px;
            border-radius: 50px; cursor: pointer; font-weight: 700; font-size: 13px;
            color: #475569; transition: all 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .control-btn:hover { transform: translateY(-2px); background: white; }
        .control-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4); }

        /* SIDEBAR */
        .sidebar {
            position: absolute; top: 110px; left: 20px; width: 340px;
            max-height: calc(100vh - 140px);
            background: var(--glass);
            backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
            border-radius: 20px; padding: 20px;
            box-shadow: var(--shadow);
            display: flex; flex-direction: column; gap: 15px; z-index: 5;
            border: 1px solid rgba(255,255,255,0.5);
        }

        /* STATISTIK */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-box {
            background: rgba(255,255,255,0.6); border: 1px solid rgba(255,255,255,0.8);
            padding: 12px; border-radius: 12px; text-align: center;
        }
        .stat-val { font-size: 24px; font-weight: 800; color: #1e293b; line-height: 1; margin-bottom: 4px; }
        .stat-lbl { font-size: 10px; font-weight: 700; color: #64748b; text-transform: uppercase; }

        /* FILTER */
        .filter-title { font-size: 11px; font-weight: 800; color: #94a3b8; margin-bottom: 8px; }
        .chips-container { display: flex; flex-wrap: wrap; gap: 6px; }
        .chip {
            padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 600;
            background: white; border: 1px solid #e2e8f0; color: #64748b; cursor: pointer; transition: 0.2s;
        }
        .chip.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* LIST LOKASI */
        .loc-list { overflow-y: auto; flex-grow: 1; padding-right: 5px; scrollbar-width: thin; }
        .loc-card {
            background: rgba(255,255,255,0.5); border-radius: 12px; padding: 12px;
            margin-bottom: 8px; cursor: pointer; transition: all 0.2s;
            border-left: 4px solid transparent; display: flex; justify-content: space-between; align-items: center;
        }
        .loc-card:hover { background: white; transform: translateX(4px); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .loc-info h4 { margin: 0; font-size: 13px; color: #334155; font-weight: 700; }
        .loc-info span { font-size: 11px; color: #64748b; margin-top: 2px; display: block; }
        
        .loc-card.risk-Tinggi { border-left-color: var(--danger); }
        .loc-card.risk-Sedang { border-left-color: var(--accent); }
        .loc-card.risk-Rendah { border-left-color: var(--success); }
        /* Style Khusus Hotel di List */
        .loc-card[data-sector="Hotel"] .loc-info h4 { color: var(--purple); }

        /* POPUP MAP */
        .mapboxgl-popup-content { border-radius: 16px; padding: 0; overflow: hidden; border: none; box-shadow: var(--shadow); max-width: 300px; }
        .popup-header { height: 130px; background-size: cover; background-position: center; position: relative; }
        .popup-gradient { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); }
        .popup-title { position: absolute; bottom: 15px; left: 15px; right: 15px; color: white; font-weight: 700; font-size: 16px; z-index: 2; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .popup-body { padding: 15px; background: white; }
        .tag-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .tag { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 700; background: #f1f5f9; color: #475569; }
        .tag.risk-Tinggi { background: #fef2f2; color: var(--danger); }
        .tag.risk-Sedang { background: #fffbeb; color: var(--accent); }
        .tag.risk-Rendah { background: #ecfdf5; color: var(--success); }

        .btn-nav {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            width: 100%; padding: 10px 0; margin-top: 15px;
            background: var(--primary); color: white; border-radius: 10px;
            text-decoration: none; font-size: 13px; font-weight: 600;
            border: none; cursor: pointer; transition: 0.2s;
        }
        .btn-nav:hover { background: #1d4ed8; }

        /* ANIMASI MARKER */
        .marker-dot {
            width: 20px; height: 20px; border-radius: 50%;
            background: var(--primary); border: 3px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; position: relative;
        }
        .marker-dot::after {
            content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 30px; height: 30px; border-radius: 50%; border: 2px solid var(--primary); opacity: 0; animation: pulse 2s infinite;
        }
        /* Warna Marker */
        .marker-dot.risk-Tinggi { background: var(--danger); }
        .marker-dot.risk-Tinggi::after { border-color: var(--danger); }
        .marker-dot.risk-Sedang { background: var(--accent); }
        .marker-dot.risk-Sedang::after { border-color: var(--accent); }
        .marker-dot.risk-Rendah { background: var(--success); }
        .marker-dot.risk-Rendah::after { border-color: var(--success); }
        
        /* Marker Khusus Hotel (Ungu) */
        .marker-dot.sector-Hotel { background: var(--purple); }
        .marker-dot.sector-Hotel::after { border-color: var(--purple); }

        @keyframes pulse { 0% { width: 20px; height: 20px; opacity: 0.8; } 100% { width: 50px; height: 50px; opacity: 0; } }

        /* RESPONSIVE */
        .mapboxgl-ctrl-top-right { top: 90px; right: 10px; }
        @media (max-width: 600px) {
            .page-header { width: calc(100% - 70px); top: 15px; left: 15px; padding: 10px 15px; }
            .header-logo { width: 35px; height: 35px; font-size: 16px; }
            .header-text h1 { font-size: 15px; }
            .controls-group { bottom: 30px; top: auto; width: 100%; justify-content: center; }
            .sidebar { top: auto; bottom: 85px; left: 10px; width: calc(100% - 60px); max-height: 40vh; }
            .mapboxgl-ctrl-top-right { display: none; }
        }
    </style>
</head>
<body>

<div id="map"></div>

<div class="page-header">
    <div class="header-logo"><i class="fas fa-map-marked-alt"></i></div>
    <div class="header-text">
        <h1>SIDOARJO MAPS</h1>
        <p>Portal Wisata, Ekraf & Hotel</p>
    </div>
</div>

<div class="controls-group">
    <button class="control-btn active" id="btn-street" onclick="changeStyle('streets')"><i class="fas fa-city"></i> Peta Jalan</button>
    <button class="control-btn" id="btn-sat" onclick="changeStyle('satellite')"><i class="fas fa-satellite"></i> Satelit 3D</button>
</div>

<div class="sidebar" id="sidebar">
    <div class="stats-grid">
        <div class="stat-box">
            <div class="stat-val" style="color:var(--primary)" id="total-count">0</div>
            <div class="stat-lbl">Total Lokasi</div>
        </div>
        <div class="stat-box">
            <div class="stat-val" style="color:var(--danger)" id="risk-count">0</div>
            <div class="stat-lbl">Risiko Tinggi</div>
        </div>
    </div>

    <div>
        <div class="filter-title">FILTER KATEGORI</div>
        <div class="chips-container" id="filters">
            <div class="chip active" onclick="filterData('all', this)">Semua</div>
            <div class="chip" onclick="filterData('Pariwisata', this)">Wisata</div>
            <div class="chip" onclick="filterData('Hotel', this)">Hotel/Penginapan</div>
            <div class="chip" onclick="filterData('Kuliner', this)">Kuliner</div>
            <div class="chip" onclick="filterData('Kriya', this)">Kriya/Fashion</div>
            <div class="chip" onclick="filterData('Pertanian', this)">Agrowisata</div>
        </div>
    </div>

    <div class="loc-list" id="location-list"></div>
</div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiYWRlbnNldHlvOTEiLCJhIjoiY21qcng1NGNkNGs3bzNpb3dwN2F4d21iMiJ9.HuxCF8jOGISuEBdyjOJznw';

    // SETUP PETA
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v12', 
        center: [112.7150, -7.4500],
        zoom: 11,
        pitch: 50,
        bearing: 0,
        projection: 'globe',
        antialias: true
    });

    // EFEK ATMOSFER
    map.on('style.load', () => {
        map.setFog({
            'color': 'rgb(186, 210, 235)',
            'high-color': 'rgb(36, 92, 223)',
            'horizon-blend': 0.02,
            'space-color': 'rgb(11, 11, 25)',
            'star-intensity': 0.6
        });
    });

    // NAVIGASI
    const directions = new MapboxDirections({
        accessToken: mapboxgl.accessToken,
        unit: 'metric',
        profile: 'mapbox/driving',
        controls: { inputs: true, instructions: true, profileSwitcher: false },
        language: 'id'
    });
    map.addControl(directions, 'top-right');

    // --- DATABASE LOKASI SIDOARJO (TERLENGKAP: 24 LOKASI) ---
    const dataStore = [
        // === 1. HOTEL & AKOMODASI (8 LOKASI BARU) ===
        {
            id:101, nama: "Aston Sidoarjo City Hotel", sektor: "Hotel", kec: "Buduran",
            lat: -7.4349, lng: 112.6942, risk: "Rendah",
            img: "https://images.unsplash.com/photo-1566073771259-6a8506099945?auto=format&fit=crop&w=600&q=80",
            desc: "Hotel bintang 3 dengan fasilitas lengkap dan lokasi strategis dekat pintu tol."
        },
        {
            id:102, nama: "Luminor Hotel Sidoarjo", sektor: "Hotel", kec: "Sidoarjo",
            lat: -7.4488, lng: 112.7031, risk: "Rendah",
            img: "https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?auto=format&fit=crop&w=600&q=80",
            desc: "Hotel modern di pusat kota dengan akses mudah ke kawasan kuliner."
        },
        {
            id:103, nama: "Premier Place Hotel", sektor: "Hotel", kec: "Gedangan",
            lat: -7.3805, lng: 112.7458, risk: "Rendah",
            img: "https://images.unsplash.com/photo-1571003123894-1f0594d2b5d9?auto=format&fit=crop&w=600&q=80",
            desc: "Hotel berkonsep resort di dekat Bandara Juanda."
        },
        {
            id:104, nama: "Swiss-Belinn Airport", sektor: "Hotel", kec: "Gedangan",
            lat: -7.3800, lng: 112.7424, risk: "Rendah",
            img: "https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?auto=format&fit=crop&w=600&q=80",
            desc: "Pilihan utama transit wisatawan dengan akses cepat ke Bandara."
        },
        {
            id:105, nama: "Hotel Neo+ Waru", sektor: "Hotel", kec: "Waru",
            lat: -7.3575, lng: 112.7286, risk: "Sedang",
            img: "https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?auto=format&fit=crop&w=600&q=80",
            desc: "Hotel budget modern yang cocok untuk pebisnis di area Waru."
        },
        {
            id:106, nama: "Favehotel Sidoarjo", sektor: "Hotel", kec: "Sidoarjo",
            lat: -7.4395, lng: 112.7209, risk: "Rendah",
            img: "https://images.unsplash.com/photo-1596436889106-be35e843f974?auto=format&fit=crop&w=600&q=80",
            desc: "Hotel ikonik di jantung kota Sidoarjo dengan nuansa pink."
        },
        {
            id:107, nama: "The Sun Hotel", sektor: "Hotel", kec: "Sidoarjo",
            lat: -7.4495, lng: 112.7101, risk: "Rendah",
            img: "https://images.unsplash.com/photo-1611892440504-42a792e24d32?auto=format&fit=crop&w=600&q=80",
            desc: "Terintegrasi langsung dengan Suncity Mall dan Waterpark."
        },
        {
            id:108, nama: "Cordela Inn Sidoarjo", sektor: "Hotel", kec: "Sidoarjo",
            lat: -7.4367, lng: 112.7148, risk: "Sedang",
            img: "https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?auto=format&fit=crop&w=600&q=80",
            desc: "Penginapan nyaman di kawasan Pagerwojo."
        },

        // === 2. PARIWISATA & HERITAGE ===
        { 
            id:1, nama: "Pabrik Gula Candi Baru", sektor: "Pariwisata", kec: "Candi", 
            lat: -7.4754, lng: 112.7138, risk: "Rendah", 
            img: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/75/Pabrik_Gula_Candi_Baru_Sidoarjo.jpg/640px-Pabrik_Gula_Candi_Baru_Sidoarjo.jpg", 
            desc: "Bangunan bersejarah peninggalan kolonial."
        },
        { 
            id:2, nama: "Candi Pari", sektor: "Pariwisata", kec: "Porong", 
            lat: -7.5453, lng: 112.7126, risk: "Rendah", 
            img: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Candi_Pari.jpg/640px-Candi_Pari.jpg", 
            desc: "Candi peninggalan Majapahit di Porong."
        },
        { 
            id:3, nama: "Museum Mpu Tantular", sektor: "Pariwisata", kec: "Buduran", 
            lat: -7.4300, lng: 112.7214, risk: "Sedang", 
            img: "https://assets-a1.kompasiana.com/items/album/2019/07/22/img-20190721-125011-5d35ad360d8230214c776fb2.jpg", 
            desc: "Museum Negeri Jatim dengan koleksi geologi dan sejarah."
        },

        // === 3. AGROWISATA & PERTANIAN ===
        {
            id:4, nama: "Agrowisata Puspa Lebo", sektor: "Pertanian", kec: "Sukodono",
            lat: -7.412, lng: 112.680, risk: "Rendah",
            img: "https://diskominfo.jatimprov.go.id/uploads/2019/08/Agro-Puspa-Lebo-Sidoarjo.jpg",
            desc: "Pusat pengembangan pertanian modern."
        },
        {
            id:5, nama: "Wisata Petik Jambu Kebaron", sektor: "Pertanian", kec: "Tulangan",
            lat: -7.485, lng: 112.645, risk: "Sedang",
            img: "https://i.ytimg.com/vi/a_64L3dO_f8/maxresdefault.jpg",
            desc: "Kebun jambu kristal milik warga desa."
        },
        {
            id:6, nama: "Kampung Bebek Candi", sektor: "Pertanian", kec: "Candi",
            lat: -7.488, lng: 112.730, risk: "Sedang",
            img: "https://cdn.timesmedia.co.id/images/2021/03/13/Kampung-Bebek-Sidoarjo.jpg",
            desc: "Sentra peternakan bebek dan telur asin."
        },
        {
            id:7, nama: "Agrowisata Sambibulu", sektor: "Pertanian", kec: "Taman",
            lat: -7.362, lng: 112.678, risk: "Tinggi",
            img: "https://i.ytimg.com/vi/pn78wAdsISI/maxresdefault.jpg",
            desc: "Wisata edukasi pertanian mini."
        },

        // === 4. KULINER LEGENDARIS ===
        { 
            id:8, nama: "Rawon Gajah Mada", sektor: "Kuliner", kec: "Sidoarjo", 
            lat: -7.456, lng: 112.716, risk: "Rendah", 
            img: "https://assets-pergikuliner.com/uploads/image/picture/1782631/picture-1579243765.jpg", 
            desc: "Kuliner rawon paling ikonik di Sidoarjo."
        },
        { 
            id:9, nama: "Lontong Kupang Pak Misari", sektor: "Kuliner", kec: "Buduran", 
            lat: -7.435, lng: 112.722, risk: "Rendah", 
            img: "https://img.okezone.com/content/2022/10/01/298/2678601/lontong-kupang-pak-misari-kuliner-legendaris-sidoarjo-langganan-artis-ibu-kota-9Q8ZgZgZgZ.jpg", 
            desc: "Sajian khas Sidoarjo berbahan kerang kecil."
        },
        { 
            id:10, nama: "Pazkul Kahuripan Nirwana", sektor: "Kuliner", kec: "Sidoarjo", 
            lat: -7.445, lng: 112.705, risk: "Rendah", 
            img: "https://i.ytimg.com/vi/8s6lB5V5_5E/maxresdefault.jpg", 
            desc: "Pusat kuliner modern konsep outdoor."
        },
        { 
            id:11, nama: "Ote-Ote Porong", sektor: "Kuliner", kec: "Porong", 
            lat: -7.534, lng: 112.796, risk: "Sedang", 
            img: "https://asset.kompas.com/crops/Ote-Ote-Porong.jpg", 
            desc: "Jajanan legendaris khas Porong."
        },

        // === 5. FASHION & EKRAF ===
        { 
            id:12, nama: "Indah Bordir", sektor: "Kriya", kec: "Sidoarjo", 
            lat: -7.442, lng: 112.721, risk: "Rendah", 
            img: "https://lh5.googleusercontent.com/p/AF1QipN-0_0_0_0_0_0_0_0_0_0_0_0_0_0_0_0_0/w408-h306-k-no", 
            desc: "Pusat busana muslim dan bordir terbesar."
        },
        { 
            id:13, nama: "Batik Sari Kenongo", sektor: "Kriya", kec: "Tulangan", 
            lat: -7.492, lng: 112.651, risk: "Sedang", 
            img: "https://batiksarikenongo.com/wp-content/uploads/2021/06/galeri-batik-sari-kenongo.jpg", 
            desc: "Sentra batik tulis khas Sidoarjo."
        },
        { 
            id:14, nama: "Suncity Mall Sidoarjo", sektor: "Fesyen", kec: "Sidoarjo", 
            lat: -7.449, lng: 112.711, risk: "Rendah", 
            img: "https://lh5.googleusercontent.com/p/AF1QipP_P_P_P_P_P_P_P_P_P_P_P_P_P_P_P_P/w408-h306-k-no", 
            desc: "Pusat perbelanjaan modern."
        },
        { 
            id:15, nama: "Kampung Batik Jetis", sektor: "Kriya", kec: "Sidoarjo", 
            lat: -7.4389, lng: 112.7150, risk: "Rendah", 
            img: "https://asset.kompas.com/crops/O3vB1k5qQv6KqJ6yQv6KqJ6yQv6=/0x0:1000x667/750x500/data/photo/2020/10/02/5f76a5b6a5b6a.jpg", 
            desc: "Sentra batik tulis legendaris di tengah kota."
        },
        { 
            id:16, nama: "Industri Tas Tanggulangin", sektor: "Fesyen", kec: "Tanggulangin", 
            lat: -7.5056, lng: 112.6980, risk: "Tinggi", 
            img: "https://images.unsplash.com/photo-1549448830-4e50889218d6?auto=format&fit=crop&w=600&q=80", 
            desc: "Sentra kerajinan kulit dan tas."
        }
    ];

    map.on('load', () => {
        add3DBuildings();
        renderPoints(dataStore);
        updateStats(dataStore);
    });

    // FUNGSI GANTI STYLE
    window.changeStyle = function(style) {
        document.getElementById('btn-street').classList.remove('active');
        document.getElementById('btn-sat').classList.remove('active');

        if (style === 'streets') {
            document.getElementById('btn-street').classList.add('active');
            map.setStyle('mapbox://styles/mapbox/streets-v12');
        } else {
            document.getElementById('btn-sat').classList.add('active');
            map.setStyle('mapbox://styles/mapbox/satellite-streets-v12');
        }

        map.once('style.load', () => {
            add3DBuildings();
            map.setFog({});
            renderPoints(dataStore);
        });
    }

    // LAYER GEDUNG 3D
    function add3DBuildings() {
        if(map.getLayer('3d-buildings')) return;
        const layers = map.getStyle().layers;
        const labelLayerId = layers.find(l => l.type === 'symbol' && l.layout['text-field']).id;
        map.addLayer({
            'id': '3d-buildings',
            'source': 'composite',
            'source-layer': 'building',
            'filter': ['==', 'extrude', 'true'],
            'type': 'fill-extrusion',
            'minzoom': 13,
            'paint': {
                'fill-extrusion-color': '#aaa',
                'fill-extrusion-height': ['get', 'height'],
                'fill-extrusion-base': ['get', 'min_height'],
                'fill-extrusion-opacity': 0.6
            }
        }, labelLayerId);
    }

    let currentMarkers = [];

    function renderPoints(data) {
        currentMarkers.forEach(m => m.remove());
        currentMarkers = [];
        const listEl = document.getElementById('location-list');
        listEl.innerHTML = '';

        data.forEach(item => {
            const el = document.createElement('div');
            // Cek apakah ini Hotel untuk warna ungu, jika tidak cek risiko
            let markerClass = `marker-dot risk-${item.risk}`;
            if(item.sektor === 'Hotel') markerClass += ' sector-Hotel';
            
            el.className = markerClass;
            
            const marker = new mapboxgl.Marker(el)
                .setLngLat([item.lng, item.lat])
                .setPopup(createPopup(item))
                .addTo(map);
            currentMarkers.push(marker);

            const card = document.createElement('div');
            card.className = `loc-card risk-${item.risk}`;
            // Tambahkan atribut data-sector
            card.setAttribute('data-sector', item.sektor);
            
            card.innerHTML = `
                <div class="loc-info">
                    <h4>${item.nama}</h4>
                    <span>${item.sektor} â€¢ ${item.kec}</span>
                </div>
                <div style="font-size:16px; color:#cbd5e1;"><i class="fas fa-chevron-right"></i></div>
            `;
            card.addEventListener('click', () => {
                map.flyTo({ center: [item.lng, item.lat], zoom: 16, pitch: 60, bearing: 20 });
                marker.togglePopup();
            });
            listEl.appendChild(card);
        });
    }

    function createPopup(item) {
        return new mapboxgl.Popup({ offset: 25, closeButton: false }).setHTML(`
            <div class="popup-header" style="background-image: url('${item.img}');">
                <div class="popup-gradient"></div>
                <div class="popup-title">${item.nama}</div>
            </div>
            <div class="popup-body">
                <div class="tag-row">
                    <span class="tag">${item.sektor}</span>
                    <span class="tag risk-${item.risk}">${item.risk} Risk</span>
                </div>
                <p style="margin:0; font-size:12px; line-height:1.5; color:#475569;">${item.desc}</p>
                <button class="btn-nav" onclick="startNavigation(${item.lng}, ${item.lat})">
                    <i class="fas fa-location-arrow"></i> Rute Navigasi
                </button>
            </div>
        `);
    }

    window.startNavigation = function(destLng, destLat) {
        directions.setDestination([destLng, destLat]);
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                directions.setOrigin([pos.coords.longitude, pos.coords.latitude]);
                map.flyTo({ center: [pos.coords.longitude, pos.coords.latitude], zoom: 14 });
            }, () => alert("Aktifkan GPS Browser!"));
        } else { alert("GPS tidak didukung"); }
    }

    window.filterData = function(cat, el) {
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        const filtered = (cat === 'all') ? dataStore : dataStore.filter(d => {
            if (cat === 'Kriya') return d.sektor === 'Kriya' || d.sektor === 'Fesyen';
            return d.sektor === cat;
        });
        renderPoints(filtered);
    }

    function updateStats(data) {
        document.getElementById('total-count').innerText = data.length;
        document.getElementById('risk-count').innerText = data.filter(d => d.risk === 'Tinggi').length;
    }
</script>

</body>
</html>